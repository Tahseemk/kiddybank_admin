import{j as e,d as l,r as C,S as z,t as m,u as K}from"./index-n-Mj-w5F.js";import{l as Q,a as W,b as X,c as ee}from"./Layout-Uoy8HDDZ.js";import{d as E}from"./ProductServices-ppfcihlB.js";import{d as $,u as se}from"./index-oM8Nn_6I.js";import{T as _,D as le,u as H,M as Y}from"./DrawerButton-CC7bgkMS.js";import{u as ae}from"./useFilter-Zzka6Kl5.js";import{u as q,P as te}from"./PageTitle-tRfcP2yT.js";import{D as Z,E as re}from"./EditDeleteButton-RGitrSAk.js";import{a as ie,S as ne,B as de}from"./BulkActionDrawer-IN1fGV6Z.js";import{E as P}from"./AdminServices-G0hlKUD3.js";import{I as R}from"./InputArea-BBW6Yhkf.js";import{u as me,L as A}from"./index.esm-cFreCkwr.js";import{U as oe}from"./Uploader-8ANEOpFA.js";import{a as V,n as L}from"./toast--43O7F4z.js";import{T as ce}from"./TableLoading-fjBCCBKo.js";import{C as G,S as xe}from"./ShowHideButton-0v0Cvicz.js";import{N as ge}from"./NotFound-q_Rgz-SQ.js";import{U as pe}from"./UploadManyTwo-oEqFeSV7.js";import"./iconBase-gI-AVLnd.js";import"./httpService-jqtz-xtI.js";import"./spinner-R50PTWTV.js";import"./useDispatch-oTJCh-Ew.js";import"./index-MepfRMvd.js";import"./tslib.es6-YYMLUA4o.js";import"./exportFromJSON-vc2Lqcy6.js";const O=({name:a,label:r,type:h,disabled:i,register:d,required:T,maxValue:o,minValue:c,currency:j,product:x,defaultValue:g,placeholder:p})=>{const w={valueAsNumber:!0,required:T?!1:`${r} is required!`,max:{value:o,message:`Maximum value ${o}!`},min:{value:c,message:`Minimum value ${c}!`},pattern:{value:/^[0-9]*$/,message:`Invalid ${r}!`}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-row",children:[x&&e.jsx("span",{className:"inline-flex items-center px-3 rounded rounded-r-none border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm  focus:border-emerald-300 dark:bg-gray-700 dark:text-gray-300 dark:border dark:border-gray-600",children:j}),e.jsx(l.Input,{...d(`${a}`,w),type:h,name:a,step:.01,disabled:i,placeholder:p,defaultValue:g,className:`mr-2 p-2 ${x&&"rounded-l-none"}`})]})})},ue=a=>{const{isDrawerOpen:r,closeDrawer:h,setIsUpdate:i,lang:d}=C.useContext(z),[T,o]=C.useState(""),[c,j]=C.useState(d),[x,g]=C.useState({}),[p,w]=C.useState(!1),[N,s]=C.useState(!1),[y,b]=C.useState(!1),{currency:v}=q(),{register:D,handleSubmit:I,setValue:n,clearErrors:S,formState:{errors:U}}=me(),M=async u=>{var k,F;try{b(!0);const f={title:{[c]:u.title},couponCode:u.couponCode,endTime:u.endTime,minimumAmount:u.minimumAmount,logo:T,lang:c,status:p?"show":"hide",discountType:{type:N?"percentage":"fixed",value:u.discountPercentage},productType:u.productType};if(a){const t=await E.updateCoupon(a,f);i(!0),b(!1),L(t.message),h()}else{const t=await E.addCoupon(f);i(!0),b(!1),L(t.message),h()}}catch(f){V(((F=(k=f==null?void 0:f.response)==null?void 0:k.data)==null?void 0:F.message)||(f==null?void 0:f.message)),b(!1),h()}},B=u=>{j(u),Object.keys(x).length>0&&n("title",x.title[u||"en"])};return C.useEffect(()=>{if(!r){g({}),n("title"),n("productType"),n("couponCode"),n("endTime"),n("discountPercentage"),n("minimumAmount"),o(""),S("title"),S("productType"),S("couponCode"),S("endTime"),S("discountPercentage"),S("minimumAmount"),j(d),n("language",c);return}a&&(async()=>{var u,k,F,f;try{const t=await E.getCouponById(a);t&&(g(t),n("title",t.title[c||"en"]),n("productType",t.productType),n("couponCode",t.couponCode),n("endTime",$(t.endTime).format("YYYY-MM-DD HH:mm")),n("discountPercentage",(u=t.discountType)==null?void 0:u.value),n("minimumAmount",t.minimumAmount),w(t.status==="show"),s(((k=t.discountType)==null?void 0:k.type)==="percentage"),o(t.logo))}catch(t){V(((f=(F=t==null?void 0:t.response)==null?void 0:F.data)==null?void 0:f.message)||(t==null?void 0:t.message))}})()},[a,n,r,S,c,d]),{register:D,handleSubmit:I,onSubmit:M,errors:U,setImageUrl:o,imageUrl:T,published:p,setPublished:w,currency:v,discountType:N,isSubmitting:y,setDiscountType:s,handleSelectLanguage:B}},he=({title:a,handleProcess:r,processOption:h,product:i,handleIsCombination:d})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:`${i?"mb-3 flex flex-wrap justify-end items-center mr-8":"mb-3"}`,children:e.jsxs("div",{className:"flex flex-wrap items-center",children:[i?e.jsx("label",{className:"block text-base font-normal text-orange-500 dark:text-orange-400 mx-4",children:"Does this product have variants?"}):e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:a}),e.jsx(ie,{onChange:i?d:r,checked:h,className:"react-switch",uncheckedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingRight:45,paddingTop:1},children:"Fixed"}),width:125,height:33,handleDiameter:28,offColor:"#E53E3E",onColor:"#2F855A",checkedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingLeft:50,paddingTop:1},children:"Percentage"})})]})})}),J=({id:a})=>{const{register:r,handleSubmit:h,onSubmit:i,errors:d,setImageUrl:T,imageUrl:o,published:c,setPublished:j,currency:x,discountType:g,setDiscountType:p,isSubmitting:w,handleSelectLanguage:N}=ue(a);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative  p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 ",children:a?e.jsx(_,{register:r,handleSelectLanguage:N,title:m("UpdateCoupon"),description:m("UpdateCouponDescription")}):e.jsx(_,{register:r,handleSelectLanguage:N,title:m("AddCoupon"),description:m("AddCouponDescription")})}),e.jsx(Q.Scrollbars,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:h(i),children:[e.jsxs("div",{className:"px-6 pt-8 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("CouponBannerImage")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(oe,{imageUrl:o,setImageUrl:T,folder:"coupon"})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("CampaignName")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(R,{register:r,label:"Coupon title",name:"title",type:"text",placeholder:m("CampaignName")}),e.jsx(P,{errorName:d.title})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("CampaignCode")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(R,{register:r,label:"Coupon Code",name:"couponCode",type:"text",placeholder:m("CampaignCode")}),e.jsx(P,{errorName:d.couponCode})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("CouponValidityTime")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(l.Input,{...r("endTime",{required:"Coupon Validation End Time"}),label:"Coupon Validation End Time",name:"endTime",type:"datetime-local",placeholder:m("CouponValidityTime")}),e.jsx(P,{errorName:d.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("DiscountType")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(he,{handleProcess:p,processOption:g}),e.jsx(P,{errorName:d.discountType})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("Discount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(O,{product:!0,register:r,maxValue:g?99:1e3,minValue:1,label:"Discount",name:"discountPercentage",type:"number",placeholder:g?"Percentage":"Fixed Amount",currency:g?"%":x}),e.jsx(P,{errorName:d.discountPercentage})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("MinimumAmount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(O,{product:!0,register:r,maxValue:2e5,minValue:100,label:"Minimum Amount",name:"minimumAmount",type:"number",placeholder:m("MinimumAmountPlasholder"),currency:x}),e.jsx(P,{errorName:d.minimumAmount})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("Published")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(ne,{handleProcess:j,processOption:c}),e.jsx(P,{errorName:d.productType})]})]})]}),e.jsx(le,{id:a,title:"Coupon",isSubmitting:w})]})})]})},je=({isCheck:a,coupons:r,setIsCheck:h})=>{const[i,d]=C.useState([]),{title:T,serviceId:o,handleModalOpen:c,handleUpdate:j}=H(),{currency:x,showDateFormat:g,globalSetting:p,showingTranslateValue:w}=q(),N=s=>{const{id:y,checked:b}=s.target;h([...a,y]),b||h(a.filter(v=>v!==y))};return C.useEffect(()=>{const s=r==null?void 0:r.map(y=>{const b=new Date(y==null?void 0:y.updatedAt).toLocaleString("en-US",{timeZone:p==null?void 0:p.default_time_zone});return{...y,updatedDate:b}});d(s)},[r,p==null?void 0:p.default_time_zone]),e.jsxs(e.Fragment,{children:[a.length<1&&e.jsx(Z,{id:o,title:T}),a.length<2&&e.jsx(Y,{children:e.jsx(J,{id:o})}),e.jsx(l.TableBody,{children:i==null?void 0:i.map((s,y)=>{var b,v,D,I,n;return e.jsxs(l.TableRow,{children:[e.jsx(l.TableCell,{children:e.jsx(G,{type:"checkbox",name:(b=s==null?void 0:s.title)==null?void 0:b.en,id:s._id,handleClick:N,isChecked:a==null?void 0:a.includes(s._id)})}),e.jsxs(l.TableCell,{children:[e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.logo?e.jsx(l.Avatar,{className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none",src:s==null?void 0:s.logo,alt:"product"}):e.jsx(l.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:w(s==null?void 0:s.title)})," "]})]})," "]}),e.jsxs(l.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm",children:[" ",s.couponCode]})," "]}),(v=s==null?void 0:s.discountType)!=null&&v.type?e.jsxs(l.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm font-semibold",children:[" ",((D=s==null?void 0:s.discountType)==null?void 0:D.type)==="percentage"?`${(I=s==null?void 0:s.discountType)==null?void 0:I.value}%`:`${x}${(n=s==null?void 0:s.discountType)==null?void 0:n.value}`]})," "]}):e.jsxs(l.TableCell,{children:[" ",e.jsx("span",{className:"text-sm font-semibold",children:" "})," "]}),e.jsx(l.TableCell,{className:"text-center",children:e.jsx(xe,{id:s._id,status:s.status})}),e.jsx(l.TableCell,{children:e.jsx("span",{className:"text-sm",children:g(s.startTime)})}),e.jsx(l.TableCell,{children:e.jsx("span",{className:"text-sm",children:g(s.endTime)})}),e.jsx(l.TableCell,{className:"align-middle ",children:$().isAfter($(s.endTime))?e.jsx(l.Badge,{type:"danger",children:"Expired"}):e.jsx(l.Badge,{type:"success",children:"Active"})}),e.jsx(l.TableCell,{children:e.jsx(re,{id:s==null?void 0:s._id,isCheck:a,handleUpdate:j,handleModalOpen:c,title:w(s==null?void 0:s.title)})})]},y+1)})})]})},ze=()=>{const{t:a}=K(),{toggleDrawer:r,lang:h}=C.useContext(z),{data:i,loading:d,error:T}=se(E.getAllCoupons),[o,c]=C.useState(!1),[j,x]=C.useState([]),{allId:g,serviceId:p,handleDeleteMany:w,handleUpdateMany:N}=H(),{filename:s,isDisabled:y,couponRef:b,dataTable:v,serviceData:D,totalResults:I,resultsPerPage:n,handleChangePage:S,handleSelectFile:U,setSearchCoupon:M,handleSubmitCoupon:B,handleUploadMultiple:u,handleRemoveSelectFile:k}=ae(i),F=()=>{c(!o),x(i==null?void 0:i.map(t=>t._id)),o&&x([])},f=()=>{M(""),b.current.value=""};return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:a("CouponspageTitle")}),e.jsx(Z,{ids:g,setIsCheck:x,title:"Selected Coupon"}),e.jsx(de,{ids:g,title:"Coupons"}),e.jsx(Y,{children:e.jsx(J,{id:p})}),e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(l.CardBody,{children:e.jsxs("form",{onSubmit:B,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6  xl:flex",children:[e.jsx("div",{className:"flex justify-start xl:w-1/2  md:w-full",children:e.jsx(pe,{title:"Coupon",exportData:i,filename:s,isDisabled:y,handleSelectFile:U,handleUploadMultiple:u,handleRemoveSelectFile:k})}),e.jsxs("div",{className:"lg:flex  md:flex xl:justify-end xl:w-1/2  md:w-full md:justify-start flex-grow-0",children:[e.jsx("div",{className:"w-full md:w-40 lg:w-40 xl:w-40 mr-3 mb-3 lg:mb-0",children:e.jsxs(l.Button,{disabled:j.length<1,onClick:()=>N(j),className:"w-full rounded-md h-12 btn-gray text-gray-600",children:[e.jsx("span",{className:"mr-2",children:e.jsx(W,{})}),a("BulkAction")]})}),e.jsx("div",{className:"w-full md:w-32 lg:w-32 xl:w-32 mr-3 mb-3 lg:mb-0",children:e.jsxs(l.Button,{disabled:j.length<1,onClick:()=>w(j),className:"w-full rounded-md h-12 bg-red-500 btn-red",children:[e.jsx("span",{className:"mr-2",children:e.jsx(X,{})}),a("Delete")]})}),e.jsx("div",{className:"w-full md:w-48 lg:w-48 xl:w-48",children:e.jsxs(l.Button,{onClick:r,className:"w-full rounded-md h-12",children:[e.jsx("span",{className:"mr-2",children:e.jsx(ee,{})}),a("AddCouponsBtn")]})})]})]})})}),e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(l.CardBody,{children:e.jsxs("form",{onSubmit:B,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:[e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(l.Input,{ref:b,type:"search",placeholder:a("SearchCoupon")})}),e.jsxs("div",{className:"flex items-center gap-2 flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx("div",{className:"w-full mx-1",children:e.jsx(l.Button,{type:"submit",className:"h-12 w-full bg-emerald-700",children:"Filter"})}),e.jsx("div",{className:"w-full mx-1",children:e.jsx(l.Button,{layout:"outline",onClick:f,type:"reset",className:"px-4 md:py-1 py-2 h-12 text-sm dark:bg-gray-700",children:e.jsx("span",{className:"text-black dark:text-gray-200",children:"Reset"})})})]})]})})}),d?e.jsx(ce,{row:12,col:8,width:140,height:20}):T?e.jsx("span",{className:"text-center mx-auto text-red-500",children:T}):(D==null?void 0:D.length)!==0?e.jsxs(l.TableContainer,{className:"mb-8",children:[e.jsxs(l.Table,{children:[e.jsx(l.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(l.TableCell,{children:e.jsx(G,{type:"checkbox",name:"selectAll",id:"selectAll",handleClick:F,isChecked:o})}),e.jsx(l.TableCell,{children:a("CoupTblCampaignsName")}),e.jsx(l.TableCell,{children:a("CoupTblCode")}),e.jsx(l.TableCell,{children:a("Discount")}),e.jsx(l.TableCell,{className:"text-center",children:a("catPublishedTbl")}),e.jsx(l.TableCell,{children:a("CoupTblStartDate")}),e.jsx(l.TableCell,{children:a("CoupTblEndDate")}),e.jsx(l.TableCell,{children:a("CoupTblStatus")}),e.jsx(l.TableCell,{className:"text-right",children:a("CoupTblActions")})]})}),e.jsx(je,{lang:h,isCheck:j,coupons:v,setIsCheck:x})]}),e.jsx(l.TableFooter,{children:e.jsx(l.Pagination,{totalResults:I,resultsPerPage:n,onChange:S,label:"Table navigation"})})]}):e.jsx(ge,{title:"Sorry, There are no coupons right now."})]})};export{ze as default};
