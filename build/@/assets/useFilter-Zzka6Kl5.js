import{a as Ze,P as $e,c as ke,r as Ge,u as He,C as Xe,b as Ke,d as Qe,A as We}from"./ProductServices-ppfcihlB.js";import{d as I}from"./index-oM8Nn_6I.js";import{c as le,g as me,r as o,e as ve,S as et}from"./index-n-Mj-w5F.js";import{a as y,n as E}from"./toast--43O7F4z.js";import{u as tt}from"./PageTitle-tRfcP2yT.js";var fe={exports:{}};(function(b,x){(function(O,C){b.exports=C()})(le,function(){return function(O,C,L){C.prototype.isBetween=function(N,P,S,w){var R=L(N),m=L(P),_=(w=w||"()")[0]==="(",j=w[1]===")";return(_?this.isAfter(R,S):!this.isBefore(R,S))&&(j?this.isBefore(m,S):!this.isAfter(m,S))||(_?this.isBefore(R,S):!this.isAfter(R,S))&&(j?this.isAfter(m,S):!this.isBefore(m,S))}}})})(fe);var nt=fe.exports;const st=me(nt);var Se={exports:{}};(function(b,x){(function(O,C){b.exports=C()})(le,function(){return function(O,C,L){C.prototype.isToday=function(){var N="YYYY-MM-DD",P=L();return this.format(N)===P.format(N)}}})})(Se);var ot=Se.exports;const at=me(ot),rt={type:"object",properties:{_id:{type:"string"},name:{type:"object"},description:{type:"object"},icon:{type:"string"},status:{type:"string"}},required:["name"]},it={type:"object",properties:{status:{type:"string"},title:{type:"object"},name:{type:"object"},variants:{type:"array"},option:{type:"string"},type:{type:"string"}},required:["name","title"]},dt={type:"object",properties:{title:{type:"object"},couponCode:{type:"string"},endTime:{type:"string"},discountPercentage:{type:"number"},minimumAmount:{type:"number"},productType:{type:"string"},logo:{type:"string"},discountType:{type:"object"},status:{type:"string"}},required:["title","couponCode","endTime","status"]},ut={type:"object",properties:{name:{type:"string"},email:{type:"string"}},required:["name","email"]},Nt=b=>{const x=new Ze({allErrors:!0}),[O,C]=o.useState(""),[L,N]=o.useState(""),[P,S]=o.useState(""),[w,R]=o.useState(""),[m,_]=o.useState(""),[j,ge]=o.useState(""),[D,v]=o.useState(""),[A,ee]=o.useState(""),[F,te]=o.useState(""),[ye,we]=o.useState(""),[J,Ce]=o.useState(""),[$,he]=o.useState(""),[be,Le]=o.useState([]),[De,Ae]=o.useState([]),[Te,Oe]=o.useState([]),[k,Pe]=o.useState(""),[G,Re]=o.useState(""),[M,xe]=o.useState(""),[H,Ne]=o.useState(1),[je,ne]=o.useState([]),[Be,_e]=o.useState(""),[Fe,Je]=o.useState(""),[Ue,Ie]=o.useState(""),[h,V]=o.useState([]),[Ee,q]=o.useState(""),[Me,Y]=o.useState(!1),[X,Ve]=o.useState(""),[K]=o.useState([]),se=o.useRef(""),oe=o.useRef(""),ae=o.useRef(""),re=o.useRef(""),ie=o.useRef(""),Q=o.useRef(""),de=o.useRef(""),ue=o.useRef(""),pe=o.useRef(""),qe=o.useRef(""),ce=o.useRef("");I.extend(st),I.extend(at);const c=ve(),{lang:U,setIsUpdate:z,setLoading:f}=o.useContext(et),{globalSetting:B}=tt(),T=o.useMemo(()=>{const r=new Date;r.setDate(r.getDate()-M);let t=b==null?void 0:b.map(e=>{const i=new Date(e==null?void 0:e.updatedAt).toLocaleString("en-US",{timeZone:B==null?void 0:B.default_time_zone});return{...e,updatedDate:i==="Invalid Date"?"":i}});if(c.pathname==="/dashboard"){const e=t==null?void 0:t.filter(p=>p.status==="Pending");Le(e);const i=t==null?void 0:t.filter(p=>p.status==="Processing");Ae(i);const n=t==null?void 0:t.filter(p=>p.status==="Delivered");Oe(n);const u=t==null?void 0:t.filter(p=>I(p.createdAt).isToday()),l=u==null?void 0:u.reduce((p,g)=>p+g.total,0);_e(l);const s=t==null?void 0:t.filter(p=>I(p.createdAt).isBetween(new Date().setDate(new Date().getDate()-30),new Date)),a=s==null?void 0:s.reduce((p,g)=>p+g.total,0);Je(a);const W=t==null?void 0:t.reduce((p,g)=>p+g.total,0);Ie(W)}return O&&(t=t.filter(e=>e.parent===O)),L==="Low"&&(t=t.sort((e,i)=>e.price<i.price&&-1)),L==="High"&&(t=t.sort((e,i)=>e.price>i.price&&-1)),P&&(t=t.filter(e=>{var i;return(i=e==null?void 0:e.title)==null?void 0:i.toLowerCase().includes(P.toLowerCase())})),A&&(t=t.filter(e=>{var i,n,u;return((n=(i=e==null?void 0:e.title[U])==null?void 0:i.toLowerCase())==null?void 0:n.includes(A==null?void 0:A.toLowerCase()))||((u=e==null?void 0:e.attribute)==null?void 0:u.toLowerCase().includes(A==null?void 0:A.toLowerCase()))})),D&&(t=t.filter(e=>{var i,n,u;return((n=(i=e==null?void 0:e.name[U])==null?void 0:i.toLowerCase())==null?void 0:n.includes(D==null?void 0:D.toLowerCase()))||((u=e==null?void 0:e.category)==null?void 0:u.toLowerCase().includes(D==null?void 0:D.toLowerCase()))})),G&&(t=t.filter(e=>e.role===G)),w&&(t=t.filter(e=>{var i,n,u,l,s,a;return((i=e==null?void 0:e.name[U])==null?void 0:i.toLowerCase().includes(w.toLowerCase()))||((u=(n=e==null?void 0:e.phone)==null?void 0:n.toString())==null?void 0:u.toLowerCase().includes(w.toLowerCase()))||((s=(l=e==null?void 0:e.mobile)==null?void 0:l.toString())==null?void 0:s.toLowerCase().includes(w.toLowerCase()))||((a=e==null?void 0:e.email)==null?void 0:a.toLowerCase().includes(w.toLowerCase()))})),m&&(t=t==null?void 0:t.filter(e=>{var i,n,u;return((n=(i=e==null?void 0:e.title[U])==null?void 0:i.toLowerCase())==null?void 0:n.includes(m==null?void 0:m.toLowerCase()))||((u=e==null?void 0:e.couponCode)==null?void 0:u.toLowerCase().includes(m==null?void 0:m.toLowerCase()))})),k&&(t=t.filter(e=>e.status===k)),j&&(t=t.filter(e=>e.contact.toLowerCase().includes(j.toLowerCase()))),M&&(t=t.filter(e=>I(e.createdAt).isBetween(r,new Date))),F&&(t=t.filter(e=>{var i,n;return((i=e==null?void 0:e.name)==null?void 0:i.toLowerCase().includes(F.toLowerCase()))||((n=e==null?void 0:e.iso_code)==null?void 0:n.toLowerCase().includes(F.toLowerCase()))})),X&&(t=t.filter(e=>e==null?void 0:e.name.toLowerCase().includes(X.toLowerCase()))),J&&(t=t.filter(e=>e.name.toLowerCase().includes(J.toLowerCase())||e.iso_code.toLowerCase().includes(J.toLowerCase())||e.language_code.toLowerCase().includes(J.toLowerCase()))),$&&(t=t.filter(e=>e.iso_code.toLowerCase().includes($.toLowerCase()))),t},[M,b,c.pathname,O,L,P,A,D,G,w,m,k,j,F,X,J,$,Q,B==null?void 0:B.default_time_zone,U]),Z=20,Ye=T==null?void 0:T.length,ze=r=>{Ne(r)};return o.useEffect(()=>{ne(T==null?void 0:T.slice((H-1)*Z,H*Z))},[T,H,Z]),{userRef:ae,searchRef:oe,couponRef:re,orderRef:ie,categoryRef:Q,attributeRef:de,pending:be,processing:De,delivered:Te,todayOrder:Be,monthlyOrder:Fe,totalOrder:Ue,setFilter:C,setSortedField:N,setStatus:Pe,setRole:Re,time:M,zone:ye,setTime:xe,taxRef:qe,setZone:we,filename:Ee,countryRef:ue,dataTable:je,serviceData:T,country:F,setSearchText:S,setCountry:te,isDisabled:Me,languageRef:pe,currencyRef:se,shippingRef:ce,setSearchUser:R,setDataTable:ne,setCategoryType:v,handleChangePage:ze,totalResults:Ye,resultsPerPage:Z,handleOnDrop:r=>{for(let t=0;t<r.length;t++)K.push(r[t].data)},setSearchCoupon:_,setAttributeTitle:ee,handleSelectFile:r=>{var i;r.preventDefault();const t=new FileReader,e=(i=r.target)==null?void 0:i.files[0];if(e&&e.type==="application/json")q(e==null?void 0:e.name),Y(!0),t.readAsText(e,"UTF-8"),t.onload=n=>{let u=JSON.parse(n.target.result),l=[];c.pathname==="/categories"&&(l=u.map(s=>({_id:s._id,id:s.id,status:s.status,name:s.name,description:s.description,parentName:s.parentName,parentId:s.parentId,icon:s.icon}))),c.pathname==="/attributes"&&(l=u.map(s=>({_id:s._id,status:s.status,title:s.title,name:s.name,variants:s.variants,option:s.option,type:s.type}))),c.pathname==="/coupons"&&(l=u.map(s=>({title:s.title,couponCode:s.couponCode,endTime:s.endTime,discountPercentage:s.discountPercentage,minimumAmount:s.minimumAmount,productType:s.productType,logo:s.logo,discountType:s.discountType,status:s.status}))),c.pathname==="/customers"&&(l=u.map(s=>({name:s.name,email:s.email,password:s.password,phone:s.phone}))),V(l)};else if(e&&e.type==="text/csv")q(e==null?void 0:e.name),Y(!0),t.onload=async n=>{const u=n.target.result,l=await ke().fromString(u);let s=[];c.pathname==="/categories"&&(s=l.map(a=>({_id:a._id,id:a.id,status:a.status,name:JSON.parse(a.name),description:JSON.parse(a.description),parentName:a.parentName,parentId:a.parentId,icon:a.icon}))),c.pathname==="/attributes"&&(s=l.map(a=>({status:a.status,title:JSON.parse(a.title),name:JSON.parse(a.name),variants:JSON.parse(a.variants),option:a.option,type:a.type}))),c.pathname==="/coupons"&&(s=l.map(a=>({title:JSON.parse(a.title),couponCode:a.couponCode,endTime:a.endTime,discountPercentage:a.discountPercentage?JSON.parse(a.discountPercentage):0,minimumAmount:a.minimumAmount?JSON.parse(a.minimumAmount):0,productType:a.productType,logo:a.logo,status:a.status}))),c.pathname==="/customers"&&(s=l.map(a=>({name:a.name,email:a.email,password:a.password,phone:a.phone}))),V(s)},t.readAsText(e);else{q(e==null?void 0:e.name),Y(!0);const n=!!t.readAsBinaryString;t.onload=function(u){const l=u.target.result,s=Ge(l,{type:n?"binary":"array",bookVBA:!0}),a=s.SheetNames[0],W=s.Sheets[a],p=He.sheet_to_json(W);let g=[];c.pathname==="/categories"&&(g=p.map(d=>({_id:d._id,id:d.id,status:d.status,name:JSON.parse(d.name),description:JSON.parse(d.description),parentName:d.parentName,parentId:d.parentId,icon:d.icon}))),c.pathname==="/attributes"&&(g=p.map(d=>({status:d.status,title:JSON.parse(d.title),name:JSON.parse(d.name),variants:JSON.parse(d.variants),option:d.option,type:d.type}))),c.pathname==="/coupons"&&(g=p.map(d=>({title:JSON.parse(d.title),couponCode:d.couponCode,endTime:d.endTime,discountPercentage:d.discountPercentage,minimumAmount:d.minimumAmount,productType:d.productType,logo:d.logo,status:d.status}))),c.pathname==="/customers"&&(g=p.map(d=>({name:d.name,email:d.email,password:d.password?d.password:"null",phone:d.phone?d.phone:"null"}))),V(g)},n?t.readAsBinaryString(e):t.readAsArrayBuffer(e)}},handleSubmitUser:r=>{r.preventDefault(),R(ae.current.value)},handleSubmitForAll:r=>{r.preventDefault(),S(oe.current.value)},handleSubmitCoupon:r=>{r.preventDefault(),_(re.current.value)},handleSubmitOrder:r=>{r.preventDefault(),ge(ie.current.value)},handleSubmitCategory:r=>{r.preventDefault(),v(Q.current.value)},handleSubmitAttribute:r=>{r.preventDefault(),ee(de.current.value)},handleUploadProducts:()=>{K.length<1?y("Please upload/select csv file first!"):$e.addAllProducts(K).then(r=>{E(r.message)}).catch(r=>y(r.message))},handleSubmitCountry:r=>{r.preventDefault(),te(ue.current.value)},handleSubmitCurrency:r=>{r.preventDefault(),he(se.current.value)},handleSubmitShipping:r=>{r.preventDefault(),Ve(ce.current.value)},handleSubmitLanguage:r=>{r.preventDefault(),Ce(pe.current.value)},handleUploadMultiple:r=>{if(h.length>1){if(c.pathname==="/categories"){f(!0);let t=h.map(n=>x.validate(rt,n));const e=n=>n===!0;t.every(e)?Xe.addAllCategory(h).then(n=>{f(!1),z(!0),E(n.message)}).catch(n=>{f(!1),y(n?n.response.data.message:n.message)}):y("Please enter valid data!")}if(c.pathname==="/customers"){f(!0);let t=h.map(n=>x.validate(ut,n));const e=n=>n===!0;t.every(e)?Ke.addAllCustomers(h).then(n=>{f(!1),z(!0),E(n.message)}).catch(n=>{f(!1),y(n?n.response.data.message:n.message)}):y("Please enter valid data!")}if(c.pathname==="/coupons"){f(!0);let t=h.map(n=>x.validate(dt,n));const e=n=>n===!0;t.every(e)?Qe.addAllCoupon(h).then(n=>{f(!1),z(!0),E(n.message)}).catch(n=>{f(!1),y(n?n.response.data.message:n.message)}):y("Please enter valid data!")}if(c.pathname==="/attributes"){f(!0);let t=h.map(n=>x.validate(it,n));const e=n=>n===!0;t.every(e)?We.addAllAttributes(h).then(n=>{f(!1),z(!0),E(n.message)}).catch(n=>{f(!1),y(n?n.response.data.message:n.message)}):y("Please enter valid data!")}}else y("Please select a valid .JSON/.CSV/.XLS file first!")},handleRemoveSelectFile:r=>{q(""),V([]),setTimeout(()=>Y(!1),1e3)}}};export{at as a,st as i,Nt as u};
